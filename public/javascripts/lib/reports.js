// Generated by CoffeeScript 1.6.3
/*
Reports for Teacher Side
*/


/*
Functions
*/


(function() {
  var issueData;

  issueData = [];

  $(function() {
    var buildTable;
    buildTable = function(arr) {
      var each, _i, _len, _results;
      $('#reportsBody').empty();
      _results = [];
      for (_i = 0, _len = arr.length; _i < _len; _i++) {
        each = arr[_i];
        _results.push($('#reportsBody').append('<tr class="issueRow" data-id=' + each['_id'] + '>' + '<td class="displayName">' + each['displayName'] + '</td>' + '<td class="issueTime" data-time=' + each['timeStamp'] + '>' + each['time'] + '</td>' + '</td><td class="waitTime">' + moment().minutes(each['totalWait']) + '</td>' + '<td>' + each['lesson'] + '</td>' + '<td>' + each['issue'] + '</td>' + '<td>' + each['comment'] + '</td>' + '</tr>'));
      }
      return _results;
    };
    $.get('/reportsInfo', function(data) {
      issueData = data;
      return buildTable(issueData);
    });
    $('th').each(function() {
      return $(this).on('click', function() {
        var sortedData, value;
        value = $(this).attr('data-type');
        sortedData = _.sortBy(issueData, function(arr) {
          return arr[value];
        });
        return buildTable(sortedData);
      });
    });
    /*
    	Filter/Search by name, date, time range, time waited, lesson, issue, comment
    */

    $('.search-menu').on('click', function() {
      var $searchInput, index;
      index = $(this).attr('data-type');
      $searchInput = $(this).closest('#reports').find('.search-input');
      $searchInput.find('.search-btn').text('Search by ' + index).attr('data-type', index);
      return $searchInput.removeClass('hidden');
    });
    $('#reports').on('click', '.search-btn', function(e) {
      var $searchval, index, searchResults, searchValue;
      e.preventDefault();
      $searchval = $(this).closest('.search-input').find('#search-value');
      searchValue = $searchval.val();
      index = $(this).attr('data-type');
      searchResults = search(issueData, searchValue, index);
      buildTable(searchResults);
      return $searchval.val('');
    });
    $('#reports').on('click', '.reset-btn', function() {
      if ($('.search-input').hasClass('hidden')) {

      } else {
        $('.search-input').addClass('hidden');
      }
      return buildTable(issueData);
    });
    $("#fromDate").datepicker({
      defaultDate: 0,
      changeMonth: true,
      numberOfMonths: 1,
      onClose: function(selectedDate) {
        return $("#toDate").datepicker("option", "minDate", selectedDate);
      }
    });
    $("#toDate").datepicker({
      defaultDate: "+1w",
      changeMonth: true,
      numberOfMonths: 1,
      onClose: function(selectedDate) {
        return $("#fromDate").datepicker("option", "maxDate", selectedDate);
      }
    });
  });

}).call(this);
